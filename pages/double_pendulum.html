<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Double Pendulum — Chaotic Motion</title>
    <style>
        :root { --bg:#f5f5f5; --accent:#0366d6; --muted:#666; }
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 2rem; background: var(--bg); }
        h1 { text-align: center; color: #333; margin-bottom: .25rem; }
        p { color: #444; line-height: 1.6; }
        .layout { display: grid; grid-template-areas: 'top' 'main' 'bottom'; gap: 16px; }
        .main { grid-area: main; }
        .note-bubble { background: #fff8dc; border: 1px solid #f0e6b6; border-radius: 8px; padding: 10px; color: #5b4b20; }
        .note-top { grid-area: top; }
        .note-bottom { grid-area: bottom; }
        .note-left { grid-area: left; }
        .note-right { grid-area: right; }
        @media(min-width: 1100px){
            .layout { grid-template-columns: 260px 1fr 260px; grid-template-areas: 'top top top' 'left main right' 'bottom bottom bottom'; }
        }
        .panel { background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px; }
        .controls { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; margin-bottom: 10px; }
        label { font-size: .9rem; color: var(--muted); }
        input[type="number"] { width: 90px; }
        input[type="range"] { width: 220px; }
        .button { background: var(--accent); border: none; color: white; padding: 8px 12px; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .button.secondary { background: #6b7280; }
        canvas { width: 100%; height: auto; background: radial-gradient(1200px 800px at 50% 0%, #ffffff, #f7fafc); border: 1px solid #ddd; border-radius: 6px; }
        .back { display: inline-block; margin-top: 18px; color: var(--accent); text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Double Pendulum</h1>
    <p>
        A classic mechanical system that quickly becomes chaotic. Adjust initial
        angles and watch how tiny changes produce widely diverging paths.
    </p>

    <div class="layout">
        <div class="note-bubble note-top">Top notes area — author explanations.</div>
        <div class="note-bubble note-left">Side notes — energy, phase space, or sensitivity remarks.</div>

        <div class="main">
        <div class="panel">
            <div class="controls">
                <label>θ₁ (deg): <input id="th1" type="number" step="1" value="120"/></label>
                <label>θ₂ (deg): <input id="th2" type="number" step="1" value="-10"/></label>
                <label>ω₁: <input id="om1" type="number" step="0.1" value="0"/></label>
                <label>ω₂: <input id="om2" type="number" step="0.1" value="0"/></label>
                <label>dt: <input id="dt" type="number" step="0.0005" value="0.005"/></label>
                <label>Speed: <input id="speed" type="range" min="1" max="20" step="1" value="5"/></label>
                <button class="button" id="toggle">Pause</button>
                <button class="button secondary" id="reset">Reset</button>
                <button class="button secondary" id="clear">Clear</button>
            </div>
        <canvas id="pendulum" width="1000" height="700"></canvas>
        </div>
        </div>

        <div class="note-bubble note-right">Side notes — label regimes or trajectories.</div>
        <div class="note-bubble note-bottom">Bottom notes — add summary or references.</div>
    </div>

    <a class="back" href="../index.html">← Back to Introduction</a>

    <script>
    function deriv(state){
        // state = [theta1, omega1, theta2, omega2]
        const g = 9.81, m1=1, m2=1, l1=1, l2=1;
        const [t1, w1, t2, w2] = state;
        const delta = t2 - t1;
        const den = (2*m1 + m2 - m2*Math.cos(2*delta));

        const dw1 = (
            -g*(2*m1 + m2)*Math.sin(t1)
            - m2*g*Math.sin(t1 - 2*t2)
            - 2*Math.sin(delta)*m2*(w2*w2*l2 + w1*w1*l1*Math.cos(delta))
        ) / (l1 * den);

        const dw2 = (
            2*Math.sin(delta) * (
                w1*w1*l1*(m1+m2)
                + g*(m1+m2)*Math.cos(t1)
                + w2*w2*l2*m2*Math.cos(delta)
            )
        ) / (l2 * den);

        return [w1, dw1, w2, dw2];
    }

    function rk4(state, dt){
        const add = (a,b,scale=1)=> a.map((v,i)=> v + scale*b[i]);
        const mul = (a,scale)=> a.map(v=> v*scale);
        const k1 = deriv(state);
        const k2 = deriv(add(state, mul(k1, dt/2)));
        const k3 = deriv(add(state, mul(k2, dt/2)));
        const k4 = deriv(add(state, mul(k3, dt)));
        const incr = [0,1,2,3].map(i => (k1[i] + 2*k2[i] + 2*k3[i] + k4[i]) * dt/6);
        return add(state, incr);
    }

    (function(){
        const canvas = document.getElementById('pendulum');
        const ctx = canvas.getContext('2d');
        let running = true;
        let dt = 0.005, speed = 5;

        function readParams(){
            dt = parseFloat(document.getElementById('dt').value);
            speed = parseInt(document.getElementById('speed').value,10);
        }

        function getInitial(){
            const d2r = Math.PI/180;
            const t1 = parseFloat(document.getElementById('th1').value)*d2r;
            const t2 = parseFloat(document.getElementById('th2').value)*d2r;
            const w1 = parseFloat(document.getElementById('om1').value);
            const w2 = parseFloat(document.getElementById('om2').value);
            return [t1,w1,t2,w2];
        }

        let state = getInitial();

        const trail = [];
        const trailMax = 500;

        function drawArm(){
            const [t1, , t2] = state;
            const origin = {x: canvas.width/2, y: 120};
            const L = 220; // pixels per unit length
            const x1 = origin.x + L*Math.sin(t1);
            const y1 = origin.y + L*Math.cos(t1);
            const x2 = x1 + L*Math.sin(t2);
            const y2 = y1 + L*Math.cos(t2);

            // soft fade
            ctx.fillStyle = 'rgba(255,255,255,0.06)';
            ctx.fillRect(0,0,canvas.width, canvas.height);

            // Update trail
            trail.push([x2,y2]); if(trail.length>trailMax) trail.shift();
            // Draw trail with fading alpha
            ctx.lineWidth = 2;
            for(let i=1;i<trail.length;i++){
                const a = i/trail.length;
                ctx.strokeStyle = `rgba(99,102,241,${0.2 + 0.6*a})`;
                ctx.beginPath();
                ctx.moveTo(trail[i-1][0], trail[i-1][1]);
                ctx.lineTo(trail[i][0], trail[i][1]);
                ctx.stroke();
            }

            // Rods with subtle gradients
            const rod = ctx.createLinearGradient(origin.x,origin.y,x1,y1);
            rod.addColorStop(0,'#374151'); rod.addColorStop(1,'#9ca3af');
            ctx.strokeStyle = rod; ctx.lineWidth = 3; ctx.lineCap = 'round';
            ctx.beginPath(); ctx.moveTo(origin.x, origin.y); ctx.lineTo(x1, y1); ctx.stroke();

            const rod2 = ctx.createLinearGradient(x1,y1,x2,y2);
            rod2.addColorStop(0,'#155e75'); rod2.addColorStop(1,'#67e8f9');
            ctx.strokeStyle = rod2; ctx.lineWidth = 3; ctx.lineCap = 'round';
            ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();

            // Pivot and bobs with shading
            ctx.fillStyle = '#1f2937'; ctx.beginPath(); ctx.arc(origin.x,origin.y,5,0,Math.PI*2); ctx.fill();
            const grd1 = ctx.createRadialGradient(x1-2,y1-2,1,x1,y1,8);
            grd1.addColorStop(0,'#93c5fd'); grd1.addColorStop(1,'#1d4ed8');
            ctx.fillStyle = grd1; ctx.beginPath(); ctx.arc(x1,y1,8,0,Math.PI*2); ctx.fill();
            const grd2 = ctx.createRadialGradient(x2-2,y2-2,1,x2,y2,10);
            grd2.addColorStop(0,'#fca5a5'); grd2.addColorStop(1,'#b91c1c');
            ctx.fillStyle = grd2; ctx.beginPath(); ctx.arc(x2,y2,10,0,Math.PI*2); ctx.fill();
        }

        function step(){
            readParams();
            if(running){
                for(let i=0;i<speed;i++){
                    state = rk4(state, dt);
                }
                drawArm();
            }
            requestAnimationFrame(step);
        }

        // Controls
        document.getElementById('toggle').addEventListener('click', (e)=>{
            running = !running;
            e.target.textContent = running ? 'Pause' : 'Resume';
        });
        document.getElementById('reset').addEventListener('click', ()=>{
            // Restore defaults
            document.getElementById('th1').value = 120;
            document.getElementById('th2').value = -10;
            document.getElementById('om1').value = 0;
            document.getElementById('om2').value = 0;
            document.getElementById('dt').value = 0.005;
            document.getElementById('speed').value = 5;
            state = getInitial();
            trail.length = 0;
            // Clear canvas background
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0,0,canvas.width, canvas.height);
            // Ensure running
            running = true; document.getElementById('toggle').textContent = 'Pause';
        });
        document.getElementById('clear').addEventListener('click', ()=>{
            ctx.clearRect(0,0,canvas.width, canvas.height);
        });

        // Prime canvas background
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0,0,canvas.width, canvas.height);

        step();
    })();
    </script>
</body>
</html>
