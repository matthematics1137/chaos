<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Double Pendulum — Chaotic Motion</title>
    <style>
        :root { --bg:#f5f5f5; --accent:#0366d6; --muted:#666; }
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 2rem; background: var(--bg); }
        h1 { text-align: center; color: #333; margin-bottom: .25rem; }
        p { color: #444; line-height: 1.6; }
        .panel { background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px; }
        .controls { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; margin-bottom: 10px; }
        label { font-size: .9rem; color: var(--muted); }
        input[type="number"] { width: 90px; }
        input[type="range"] { width: 220px; }
        .button { background: var(--accent); border: none; color: white; padding: 8px 12px; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .button.secondary { background: #6b7280; }
        canvas { width: 100%; height: auto; background: #fff; border: 1px solid #ddd; border-radius: 6px; }
        .back { display: inline-block; margin-top: 18px; color: var(--accent); text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Double Pendulum</h1>
    <p>
        A classic mechanical system that quickly becomes chaotic. Adjust initial
        angles and watch how tiny changes produce widely diverging paths.
    </p>

    <div class="panel">
        <div class="controls">
            <label>θ₁ (deg): <input id="th1" type="number" step="1" value="120"/></label>
            <label>θ₂ (deg): <input id="th2" type="number" step="1" value="-10"/></label>
            <label>ω₁: <input id="om1" type="number" step="0.1" value="0"/></label>
            <label>ω₂: <input id="om2" type="number" step="0.1" value="0"/></label>
            <label>dt: <input id="dt" type="number" step="0.0005" value="0.005"/></label>
            <label>Speed: <input id="speed" type="range" min="1" max="20" step="1" value="5"/></label>
            <button class="button" id="toggle">Pause</button>
            <button class="button secondary" id="reset">Reset</button>
            <button class="button secondary" id="clear">Clear</button>
        </div>
        <canvas id="pendulum" width="900" height="600"></canvas>
    </div>

    <a class="back" href="../index.html">← Back to Introduction</a>

    <script>
    function deriv(state){
        // state = [theta1, omega1, theta2, omega2]
        const g = 9.81, m1=1, m2=1, l1=1, l2=1;
        const [t1, w1, t2, w2] = state;
        const delta = t2 - t1;
        const den = (2*m1 + m2 - m2*Math.cos(2*delta));

        const dw1 = (
            -g*(2*m1 + m2)*Math.sin(t1)
            - m2*g*Math.sin(t1 - 2*t2)
            - 2*Math.sin(delta)*m2*(w2*w2*l2 + w1*w1*l1*Math.cos(delta))
        ) / (l1 * den);

        const dw2 = (
            2*Math.sin(delta) * (
                w1*w1*l1*(m1+m2)
                + g*(m1+m2)*Math.cos(t1)
                + w2*w2*l2*m2*Math.cos(delta)
            )
        ) / (l2 * den);

        return [w1, dw1, w2, dw2];
    }

    function rk4(state, dt){
        const add = (a,b,scale=1)=> a.map((v,i)=> v + scale*b[i]);
        const mul = (a,scale)=> a.map(v=> v*scale);
        const k1 = deriv(state);
        const k2 = deriv(add(state, mul(k1, dt/2)));
        const k3 = deriv(add(state, mul(k2, dt/2)));
        const k4 = deriv(add(state, mul(k3, dt)));
        const incr = [0,1,2,3].map(i => (k1[i] + 2*k2[i] + 2*k3[i] + k4[i]) * dt/6);
        return add(state, incr);
    }

    (function(){
        const canvas = document.getElementById('pendulum');
        const ctx = canvas.getContext('2d');
        let running = true;
        let dt = 0.005, speed = 5;

        function readParams(){
            dt = parseFloat(document.getElementById('dt').value);
            speed = parseInt(document.getElementById('speed').value,10);
        }

        function getInitial(){
            const d2r = Math.PI/180;
            const t1 = parseFloat(document.getElementById('th1').value)*d2r;
            const t2 = parseFloat(document.getElementById('th2').value)*d2r;
            const w1 = parseFloat(document.getElementById('om1').value);
            const w2 = parseFloat(document.getElementById('om2').value);
            return [t1,w1,t2,w2];
        }

        let state = getInitial();

        function drawArm(){
            const [t1, , t2] = state;
            const origin = {x: canvas.width/2, y: 100};
            const L = 200; // pixels per unit length
            const x1 = origin.x + L*Math.sin(t1);
            const y1 = origin.y + L*Math.cos(t1);
            const x2 = x1 + L*Math.sin(t2);
            const y2 = y1 + L*Math.cos(t2);

            // fade trail
            ctx.fillStyle = 'rgba(255,255,255,0.08)';
            ctx.fillRect(0,0,canvas.width, canvas.height);

            ctx.strokeStyle = '#111';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(origin.x, origin.y);
            ctx.lineTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();

            ctx.fillStyle = '#0366d6';
            ctx.beginPath(); ctx.arc(x1,y1,6,0,Math.PI*2); ctx.fill();
            ctx.fillStyle = '#ef4444';
            ctx.beginPath(); ctx.arc(x2,y2,6,0,Math.PI*2); ctx.fill();
        }

        function step(){
            readParams();
            if(running){
                for(let i=0;i<speed;i++){
                    state = rk4(state, dt);
                }
                drawArm();
            }
            requestAnimationFrame(step);
        }

        // Controls
        document.getElementById('toggle').addEventListener('click', (e)=>{
            running = !running;
            e.target.textContent = running ? 'Pause' : 'Resume';
        });
        document.getElementById('reset').addEventListener('click', ()=>{
            state = getInitial();
        });
        document.getElementById('clear').addEventListener('click', ()=>{
            ctx.clearRect(0,0,canvas.width, canvas.height);
        });

        // Prime canvas background
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0,0,canvas.width, canvas.height);

        step();
    })();
    </script>
</body>
</html>
