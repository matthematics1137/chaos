<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kuramoto Model — Synchronization</title>
  <style>
    :root { --bg:#f5f5f5; --accent:#0366d6; --muted:#666; }
    body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 2rem; background: var(--bg); }
    h1 { text-align: center; color: #333; margin-bottom: .25rem; }
    p { color: #444; line-height: 1.6; }
    .layout { display: grid; grid-template-areas: 'top' 'main' 'bottom'; gap: 16px; }
    .main { grid-area: main; }
    .note-bubble { background: #fff8dc; border: 1px solid #f0e6b6; border-radius: 8px; padding: 10px; color: #5b4b20; }
    .note-top { grid-area: top; } .note-bottom { grid-area: bottom; } .note-left { grid-area: left; } .note-right { grid-area: right; }
    @media(min-width: 1100px){ .layout { grid-template-columns: 260px 1fr 260px; grid-template-areas: 'top top top' 'left main right' 'bottom bottom bottom'; } }
    .panel { background:#fff; border:1px solid #e0e0e0; border-radius:8px; padding:12px; box-shadow:0 2px 10px rgba(0,0,0,0.04); }
    .controls { display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-bottom:10px; }
    label { font-size:.9rem; color:var(--muted); }
    input[type="number"]{ width:90px; }
    input[type="range"]{ width:220px; }
    .button{ background:var(--accent); border:none; color:#fff; padding:8px 12px; border-radius:6px; font-weight:bold; cursor:pointer; }
    .button.secondary{ background:#6b7280; }
    canvas { width:100%; height:auto; background: #fff; border:1px solid #ddd; border-radius:6px; }
    .back { display:inline-block; margin-top:18px; color:var(--accent); text-decoration:none; font-weight:bold; }
</style>
    <link rel="stylesheet" href="../assets/css/theme.css" />
</head>
<body>
  <h1>Kuramoto Model</h1>
  <p>N coupled phase oscillators with natural frequencies ωᵢ and global coupling K/N. Watch the order parameter r rise as K increases and oscillators synchronize.</p>

  <div class="layout">
    <div class="note-bubble note-top">Top notes — order parameter r and critical coupling.</div>
    <div class="note-bubble note-left">Side notes — frequency distribution and partial locking.</div>

    <div class="main">
      <div class="panel">
        <div class="controls">
          <label>N: <input id="N" type="number" step="10" value="120"/></label>
          <label>K: <input id="K" type="range" min="0" max="5" step="0.05" value="2.0"/></label>
          <label>σ (freq spread): <input id="sigma" type="number" step="0.05" value="1.0"/></label>
          <label>dt: <input id="dt" type="number" step="0.0005" value="0.02"/></label>
          <label>Speed: <input id="speed" type="range" min="1" max="30" step="1" value="12"/></label>
          <button class="button" id="toggle">Pause</button>
          <button class="button secondary" id="reset">Reset</button>
          <button class="button secondary" id="clear">Clear</button>
        </div>
        <canvas id="km" width="1000" height="700"></canvas>
        <p><a class="back" href="../index.html">← Back to Introduction</a></p>
      </div>
    </div>

    <div class="note-bubble note-right">Side notes — r = |(1/N) ∑ e^{iθᵢ}|; dot and arrow show coherence.</div>
    <div class="note-bubble note-bottom">Bottom notes — mean‑field interpretation; thresholds depend on g(ω).</div>
  </div>

  <script>
  (function(){
    const canvas=document.getElementById('km'); const ctx=canvas.getContext('2d');
    let running=true; let N=120, K=2.0, sigma=1.0, dt=0.02, speed=12;
    let theta=[], omega=[]; let t=0;
    function randn(){ // Box-Muller
      let u=0,v=0; while(u===0)u=Math.random(); while(v===0)v=Math.random();
      return Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v);
    }
    function init(){
      N=parseInt(document.getElementById('N').value,10);
      K=parseFloat(document.getElementById('K').value);
      sigma=parseFloat(document.getElementById('sigma').value);
      dt=parseFloat(document.getElementById('dt').value);
      speed=parseInt(document.getElementById('speed').value,10);
      theta=new Array(N).fill(0).map(()=>Math.random()*2*Math.PI);
      omega=new Array(N).fill(0).map(()=>sigma*randn());
      t=0;
    }
    function drawFrame(){ ctx.fillStyle='#ffffff'; ctx.fillRect(0,0,canvas.width,canvas.height); }
    function drawSystem(){
      // Left: unit circle with phases; Right: r(t) trace
      const cx=250, cy=350, R=160;
      ctx.strokeStyle='#999'; ctx.beginPath(); ctx.arc(cx,cy,R,0,Math.PI*2); ctx.stroke();
      // Order parameter
      let sumX=0,sumY=0; for(let i=0;i<N;i++){ sumX+=Math.cos(theta[i]); sumY+=Math.sin(theta[i]); }
      const rx=sumX/N, ry=sumY/N; const r=Math.hypot(rx,ry); const phi=Math.atan2(ry,rx);
      // Oscillators
      for(let i=0;i<N;i++){
        const x=cx+R*Math.cos(theta[i]); const y=cy+R*Math.sin(theta[i]); ctx.fillStyle='rgba(3,102,214,0.9)'; ctx.beginPath(); ctx.arc(x,y,2,0,Math.PI*2); ctx.fill();
      }
      // r vector
      ctx.strokeStyle='rgba(239,68,68,0.8)'; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(cx+R*r*Math.cos(phi), cy+R*r*Math.sin(phi)); ctx.stroke();
      ctx.fillStyle='#374151'; ctx.fillText(`r = ${r.toFixed(3)}`, cx-12, cy+R+20);

      // Right plot: r(t)
      if(!drawSystem.rhist){ drawSystem.rhist=[]; }
      drawSystem.rhist.push(r); if(drawSystem.rhist.length>400) drawSystem.rhist.shift();
      const x0=480, y0=60, w=460, h=580; ctx.strokeStyle='#ddd'; ctx.strokeRect(x0,y0,w,h);
      ctx.strokeStyle='#0366d6'; ctx.beginPath();
      drawSystem.rhist.forEach((rv,idx)=>{
        const px=x0 + (idx/(drawSystem.rhist.length-1))*w; const py=y0 + (1-rv)*h;
        if(idx===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
      }); ctx.stroke();
      ctx.fillStyle='#374151'; ctx.fillText('r(t)', x0+6, y0+16);
    }
    function step(){
      if(running){
        for(let s=0;s<speed;s++){
          // Compute mean field
          let sumX=0,sumY=0; for(let i=0;i<N;i++){ sumX+=Math.cos(theta[i]); sumY+=Math.sin(theta[i]); }
          const Rx=sumX/N, Ry=sumY/N; const r=Math.hypot(Rx,Ry); const psi=Math.atan2(Ry,Rx);
          for(let i=0;i<N;i++){
            const dtheta = omega[i] + K*r*Math.sin(psi - theta[i]);
            theta[i] = (theta[i] + dt*dtheta) % (2*Math.PI);
          }
          t+=dt;
        }
      }
      drawFrame(); drawSystem(); requestAnimationFrame(step);
    }
    // Controls
    document.getElementById('toggle').addEventListener('click', (e)=>{ running=!running; e.target.textContent=running?'Pause':'Resume'; });
    document.getElementById('reset').addEventListener('click', ()=>{ document.getElementById('N').value=120; document.getElementById('K').value=2.0; document.getElementById('sigma').value=1.0; document.getElementById('dt').value=0.02; document.getElementById('speed').value=12; init(); });
    document.getElementById('clear').addEventListener('click', ()=>{ drawFrame(); });
    ['N','K','sigma','dt','speed'].forEach(id=>{ document.getElementById(id).addEventListener('input', ()=>{ init(); }); });
    // init
    init(); drawFrame(); step();
  })();
  </script>
</body>
</html>
